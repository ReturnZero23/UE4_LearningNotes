# Pak 包的使用及其实现原理解析

## 背景

在 Unreal Engine 4 中通常对资源的打包方式是使用 pak 包，把一些相同的资源打在一个相同的 pak 包中，方便程序动态的下载和动态的加载。因为在使用 UE4 提供的这套打包方式遇到了一些坑，所以就此做一些记录，希望大家遇到的时候能绕过这些坑。

## 常规的使用方式

- 打包项目的时候勾选 “use pak” 选项，程序会自动把除 exe 文件之外的文件都打成一个 pak 包。
- 如果你想要分块打包有两种方案：
  - 1.使用编辑器 Primary Asset Labels 能够将资源指定 chunk id，这样打包的时候就能打到不同的 pak 包中。
  - 2.使用 UnrealPak.exe 自己打包 pak 包。这种方式非常的灵活，可以写一个脚本进行处理。UnrealPak 本身是一个命令行程序，使用的参数比较简单，网上也有很多其他人写的总结。使用的方式类似 zip。UnrealPak 也提供了压缩、签名、加密等功能。

## 什么是 Pak 包

类似于一个 zip 包，把一组文件（任何格式的文件，并非只有 ue4 生成的文件能打成 pak 包）打包成一个文件。UnrealPak 在打包一个目录的时候会吧所有文件的公共路径作为 pak 文件的挂载点。

## 为什么要使用 Pak 包

打包成一个文件，可以避免大量的散文件、方便加密、签名。UE4 还为 pak 包提供了挂载的功能，这种方式类似挂了一个虚拟磁盘，当你通过路径读取文件的时候，能够不需要解压直接读取 pak 包中的文件。挂载还能够指定挂载的优先级，通过这种方式，可以给程序打补丁，替换掉原来文件。程序会优先使用优先级高的 pak 包中的文件。

## 怎么使用 pak 包

网上提供了很多关于 pak 包挂载的的代码基本上都大同小异，但是这其中还是有些只有真的去使用了才会遇到的坑，特别是当你不懂的其中的原理的时候很容易遇到坑。